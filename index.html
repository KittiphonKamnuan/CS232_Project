<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InfoHub 360</title>
  <!-- CSS หลัก -->
  <link rel="stylesheet" href="css/styles.css">
  <!-- CSS เฉพาะส่วน -->
  <link rel="stylesheet" href="css/customer.css">
  <link rel="stylesheet" href="css/product.css">
  <link rel="stylesheet" href="css/document.css">
  <link rel="stylesheet" href="css/sales.css">
  <link rel="stylesheet" href="css/responsive.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-100">
  <!-- Preloader สำหรับแสดงขณะโหลดข้อมูล -->
  <div id="app-preloader" style="display: none;">
    <div class="spinner-container">
      <i class="fas fa-spinner fa-spin"></i>
      <p>กำลังโหลด InfoHub 360...</p>
    </div>
  </div>

  <div class="flex flex-col h-screen">
    <!-- Top Navigation -->
    <nav class="navbar">
      <div class="container">
        <div class="logo">
          <a href="index.html">
            <i class="fas fa-cube"></i>
            <span>InfoHub 360</span>
          </a>
        </div>
        <div class="user-section">
          <span class="user-greeting">สวัสดี, คุณสมชาย (พนักงานขาย)</span>
          <div class="notifications">
            <i class="fas fa-bell"></i>
            <span class="notification-count">3</span>
            <div class="notification-dropdown">
              <div class="notification-header">
                <p>การแจ้งเตือน</p>
              </div>
              <div class="notification-item">
                <p class="notification-title">ตรวจสอบลูกค้า: คุณนภา</p>
                <p class="notification-desc">ส่งใบเสนอราคาแล้ว 2 วัน</p>
              </div>
              <div class="notification-item">
                <p class="notification-title">สต๊อกใกล้หมด: TV Samsung QN90C</p>
                <p class="notification-desc">เหลือเพียง 2 เครื่อง</p>
              </div>
              <div class="notification-item">
                <p class="notification-title">โปรโมชันใหม่: เครื่องใช้ไฟฟ้า</p>
                <p class="notification-desc">เริ่ม 15 เม.ย. - 30 เม.ย. 2568</p>
              </div>
            </div>
          </div>
          <div class="user-avatar">
            <a href="profile.html">
              <span>ส</span>
            </a>
          </div>
        </div>
      </div>
    </nav>
    
    <!-- Main Content -->
    <div class="main-content">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-menu">
          <a href="index.html" class="menu-item active" data-tab="search">
            <i class="fas fa-search"></i>
            <span>ค้นหาสินค้า</span>
          </a>
          <a href="customer-list.html" class="menu-item" data-tab="customers" onclick="window.location.href='customer-list.html'; return false;">
            <i class="fas fa-users"></i>
            <span>ลูกค้าของฉัน</span>
          </a>
          <a href="sales-report.html" class="menu-item" data-tab="sales" onclick="window.location.href='sales-report.html'; return false;">
            <i class="fas fa-chart-line"></i>
            <span>ติดตามการขาย</span>
          </a>
          <a href="document-viewer.html" class="menu-item" data-tab="documents" onclick="window.location.href='document-viewer.html'; return false;">
            <i class="fas fa-file-pdf"></i>
            <span>เอกสาร</span>
          </a>
        </div>
        <div class="sidebar-footer">
          <a href="settings.html" class="menu-item" onclick="window.location.href='settings.html'; return false;">
            <i class="fas fa-cog"></i>
            <span>ตั้งค่า</span>
          </a>
          <a href="login.html" class="menu-item" onclick="window.location.href='login.html'; return false;">
            <i class="fas fa-sign-out-alt"></i>
            <span>ออกจากระบบ</span>
          </a>
        </div>
      </div>
      
      <!-- Content Area -->
      <div class="content">
        <!-- Search Tab (Default Active) -->
        <div id="search-tab" class="tab-content active">
          <div class="section-header">
            <h1>ค้นหาสินค้า</h1>
            <p>ค้นหาด้วยชื่อสินค้า, รหัส, คุณสมบัติ หรือช่วงราคา</p>
            
            <div class="search-form">
              <div class="search-input">
                <input type="text" placeholder="ค้นหาสินค้า..." id="search-keyword">
                <i class="fas fa-search"></i>
              </div>
              <div>
                <select id="category-filter">
                  <option value="">ทุกหมวดหมู่</option>
                  <option value="ทีวี">ทีวี</option>
                  <option value="เครื่องซักผ้า">เครื่องซักผ้า</option>
                  <option value="ตู้เย็น">ตู้เย็น</option>
                  <option value="เครื่องปรับอากาศ">เครื่องปรับอากาศ</option>
                </select>
              </div>
              <div>
                <button class="btn btn-primary" id="search-button">
                  ค้นหา
                </button>
              </div>
            </div>
          </div>
          
          <!-- Loading Indicator -->
          <div id="loading-indicator" class="loading-overlay">
            <div class="loading-spinner">
              <i class="fas fa-spinner fa-spin"></i>
            </div>
          </div>
          
          <!-- Error Message -->
          <div id="error-message" class="error-message" style="display: none;"></div>
          
          <div class="card">
            <h2>ผลการค้นหาล่าสุด</h2>
            
            <!-- ส่วนแสดงผลสินค้า จะถูกเติมข้อมูลผ่าน JavaScript -->
            <div id="product-list">
              <!-- พื้นที่สำหรับแสดงรายการสินค้า -->
            </div>
            
            <!-- Loading More -->
            <div class="load-more">
              <button class="btn-link" id="load-more-button">
                แสดงเพิ่มเติม
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Share Modal Template -->
  <div id="share-modal-template" style="display: none;">
    <div class="modal-header">
      <h2>ส่งข้อมูลให้ลูกค้า</h2>
      <button class="modal-close"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="modal-body">
      <div class="document-preview">
        <div class="preview-header">
          <div class="preview-thumbnail"></div>
          <div>
            <h3>Samsung QN90C 55" QLED 4K Smart TV</h3>
            <p class="product-code">รหัสสินค้า: TV-SAM-QN90C-55</p>
            <p class="price">฿45,990</p>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <h3 class="form-label">เลือกข้อมูลที่ต้องการส่ง</h3>
        
        <div class="form-grid">
          <!-- Document Selection -->
          <div>
            <p class="form-label">เอกสาร</p>
            <div class="checkbox-list">
              <div class="checkbox-group">
                <input type="checkbox" id="spec" class="checkbox-input" checked>
                <label for="spec">สเปคสินค้า</label>
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="manual" class="checkbox-input">
                <label for="manual">คู่มือการใช้งาน</label>
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="compare" class="checkbox-input" checked>
                <label for="compare">เปรียบเทียบรุ่น</label>
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="promo" class="checkbox-input">
                <label for="promo">โปรโมชันประจำเดือน</label>
              </div>
            </div>
          </div>
          
          <!-- Price and Availability -->
          <div>
            <p class="form-label">ข้อมูลราคาและสต๊อก</p>
            <div class="checkbox-list">
              <div class="checkbox-group">
                <input type="checkbox" id="price" class="checkbox-input" checked>
                <label for="price">ราคา</label>
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="stock" class="checkbox-input" checked>
                <label for="stock">สถานะสต๊อกสินค้า</label>
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="delivery" class="checkbox-input">
                <label for="delivery">ข้อมูลการจัดส่ง</label>
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="warranty" class="checkbox-input">
                <label for="warranty">รายละเอียดการรับประกัน</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Custom Message -->
      <div class="form-group">
        <p class="form-label">ข้อความเพิ่มเติม</p>
        <textarea placeholder="เพิ่มข้อความส่วนตัวถึงลูกค้า..."></textarea>
      </div>
      
      <!-- Send To -->
      <div class="form-group">
        <p class="form-label">ส่งถึงลูกค้า</p>
        
        <div class="customer-select">
          <div class="select-container">
            <select>
              <option value="">-- เลือกลูกค้า --</option>
              <option value="CUST001">คุณนภา วงศ์ประดิษฐ์ (089-123-4567)</option>
              <option value="CUST002">คุณสมศักดิ์ ใจดี (062-987-6543)</option>
              <option value="CUST003">คุณประภา เจริญพร (091-234-5678)</option>
            </select>
          </div>
          <div class="or-divider">หรือ</div>
          <div class="input-container">
            <input type="text" placeholder="กรอกอีเมลหรือเบอร์โทรศัพท์">
          </div>
        </div>
      </div>
      
      <!-- Send Methods -->
      <div class="form-group">
        <p class="form-label">ช่องทางการส่ง</p>
        
        <div class="share-methods">
          <button class="share-method share-line" data-method="line">
            <i class="fab fa-line"></i> LINE
          </button>
          <button class="share-method share-email" data-method="email">
            <i class="fas fa-envelope"></i> อีเมล
          </button>
          <button class="share-method share-sms" data-method="sms">
            <i class="fas fa-comment-alt"></i> SMS
          </button>
          <button class="share-method share-qr" data-method="qr">
            <i class="fas fa-qrcode"></i> สร้าง QR Code
          </button>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-outline modal-close">
        ยกเลิก
      </button>
      <button class="btn btn-primary" id="sendDocuments">
        ส่งข้อมูล
      </button>
    </div>
  </div>
  
  <!-- นำเข้าไฟล์ JS ข้อมูล mockup -->
  <script type="module" src="js/services/mockup-data.js"></script>
  <script type="module" src="js/services/mockup-service.js"></script>
  
  <!-- JavaScript หลัก -->
  <script src="js/scripts.js"></script>
  
  <!-- JavaScript Controllers -->
  <script type="module" src="js/controllers/product-controller.js"></script>
  
  <!-- Fix for Navigation -->
  <script>
    // แก้ไขปัญหาการนำทางไปยังหน้าอื่น
    document.addEventListener('DOMContentLoaded', function() {
      // ดึงเมนูทั้งหมดในแถบด้านข้าง
      const menuItems = document.querySelectorAll('.sidebar .menu-item');
      
      // เพิ่ม event listener สำหรับแต่ละเมนู
      menuItems.forEach(function(menuItem) {
        menuItem.addEventListener('click', function(e) {
          // ดึง URL จาก href attribute
          const targetUrl = this.getAttribute('href');
          if (targetUrl) {
            // นำทางไปยัง URL ที่ระบุ
            window.location.href = targetUrl;
          }
        });
      });
      
      // เพิ่มโค้ดเฉพาะสำหรับหน้า index.html
      const renderProductList = function(products) {
        const productListContainer = document.getElementById('product-list');
        if (!productListContainer) return;
        
        // ล้างข้อมูลเดิม
        productListContainer.innerHTML = '';
        
        // ตรวจสอบว่ามีข้อมูลสินค้าหรือไม่
        if (!products || products.length === 0) {
          productListContainer.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-search"></i>
              <p>ไม่พบสินค้าที่ตรงกับเงื่อนไขการค้นหา</p>
            </div>
          `;
          return;
        }
        
        // สร้าง HTML สำหรับแต่ละสินค้า
        products.forEach(product => {
          const productCard = document.createElement('div');
          productCard.className = 'product-card';
          
          productCard.innerHTML = `
            <div class="product-image">
              <img src="${product.images[0] || '/api/placeholder/200/150'}" alt="${product.name}">
            </div>
            <div class="product-details">
              <h3><a href="product-details.html?id=${product.id}">${product.name}</a></h3>
              <p class="product-code">รหัสสินค้า: ${product.id}</p>
              <div class="stock-status">
                <span class="${product.stock > 0 ? 'in-stock' : 'out-of-stock'}">
                  ${product.stock > 0 ? 'มีสินค้า' : 'สินค้าหมด'}
                </span>
                <span class="stock-count">(เหลือ ${product.stock} เครื่อง)</span>
              </div>
              <p class="delivery-info"><span>จัดส่ง:</span> ${product.delivery.estimatedDays}</p>
              <div class="document-links">
                <a href="document-viewer.html?type=spec&id=${product.id}" class="document-link">
                  <i class="fas fa-file-pdf"></i> สเปคสินค้า
                </a>
                <a href="document-viewer.html?type=manual&id=${product.id}" class="document-link">
                  <i class="fas fa-file-pdf"></i> คู่มือการใช้งาน
                </a>
                <a href="document-viewer.html?type=compare&id=${product.id}" class="document-link">
                  <i class="fas fa-file-pdf"></i> เปรียบเทียบรุ่น
                </a>
              </div>
            </div>
            <div class="product-action">
              <div>
                <p class="price">฿${product.price.toLocaleString()}</p>
                ${product.originalPrice ? `
                  <p class="original-price">฿${product.originalPrice.toLocaleString()}</p>
                  <p class="discount">ลด ${product.discount}%</p>
                ` : ''}
              </div>
              <div class="action-buttons">
                <button class="btn btn-primary" data-product-id="${product.id}" onclick="window.location.href='sale-details.html?action=new&product=${product.id}'">
                  <i class="fas fa-shopping-cart"></i> เพิ่มการขาย
                </button>
                <button class="btn btn-outline share-product" data-product-id="${product.id}">
                  <i class="fas fa-share-alt"></i> ส่งให้ลูกค้า
                </button>
              </div>
            </div>
          `;
          
          productListContainer.appendChild(productCard);
        });
        
        // ตั้งค่า event listener สำหรับปุ่มแชร์สินค้า
        const shareButtons = document.querySelectorAll('.share-product');
        shareButtons.forEach(button => {
          button.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            openShareModal(productId);
          });
        });
      };
      
      // ฟังก์ชันเปิด Share Modal
      const openShareModal = function(productId) {
        console.log('เปิด Share Modal สำหรับสินค้า:', productId);
        
        // ดึง Modal Template
        const modalTemplate = document.getElementById('share-modal-template');
        if (!modalTemplate) return;
        
        // สร้าง Modal element
        const modal = document.createElement('div');
        modal.className = 'modal-backdrop';
        modal.style.display = 'flex';
        modal.innerHTML = modalTemplate.innerHTML;
        
        // เพิ่ม Modal ไปยัง body
        document.body.appendChild(modal);
        
        // ตั้งค่า event listeners สำหรับปุ่มปิด Modal
        const closeButtons = modal.querySelectorAll('.modal-close');
        closeButtons.forEach(button => {
          button.addEventListener('click', () => {
            document.body.removeChild(modal);
          });
        });
        
        // ตั้งค่า event listeners สำหรับปุ่มส่งข้อมูล
        const sendButton = modal.querySelector('#sendDocuments');
        if (sendButton) {
          sendButton.addEventListener('click', () => {
            // จำลองการส่งข้อมูล
            alert('ส่งข้อมูลให้ลูกค้าเรียบร้อยแล้ว');
            document.body.removeChild(modal);
          });
        }
      };
      
      // โหลดข้อมูลสินค้าจาก mockup (จำลองการเรียก API)
      // นี่คือโค้ดที่จะทำงานเมื่อ mockup-service.js ถูกโหลด
      setTimeout(async function() {
        try {
          // แสดงโหลดดิ้ง
          const loadingIndicator = document.getElementById('loading-indicator');
          if (loadingIndicator) loadingIndicator.style.display = 'flex';
          
          // นำเข้า mockup service ด้วย dynamic import
          const module = await import('./js/services/mockup-service.js');
          const mockupService = module.default;
          
          // ดึงข้อมูลสินค้า
          const products = await mockupService.getProducts();
          
          // แสดงรายการสินค้า
          renderProductList(products);
          
          // ซ่อนโหลดดิ้ง
          if (loadingIndicator) loadingIndicator.style.display = 'none';
          
          // ตั้งค่า event listener สำหรับปุ่มค้นหา
          const searchButton = document.getElementById('search-button');
          if (searchButton) {
            searchButton.addEventListener('click', async function() {
              // แสดงโหลดดิ้ง
              if (loadingIndicator) loadingIndicator.style.display = 'flex';
              
              // ดึงค่าจากฟอร์มค้นหา
              const keyword = document.getElementById('search-keyword')?.value || '';
              const category = document.getElementById('category-filter')?.value || '';
              
              // ดึงข้อมูลสินค้าตามการค้นหา
              const filteredProducts = await mockupService.getProducts({
                search: keyword,
                category: category
              });
              
              // แสดงรายการสินค้า
              renderProductList(filteredProducts);
              
              // ซ่อนโหลดดิ้ง
              if (loadingIndicator) loadingIndicator.style.display = 'none';
            });
          }
        } catch (error) {
          console.error('เกิดข้อผิดพลาดในการโหลดข้อมูลสินค้า:', error);
          
          // แสดงข้อความผิดพลาด
          const errorMessage = document.getElementById('error-message');
          if (errorMessage) {
            errorMessage.textContent = 'เกิดข้อผิดพลาดในการโหลดข้อมูลสินค้า กรุณาลองใหม่อีกครั้ง';
            errorMessage.style.display = 'block';
          }
          
          // ซ่อนโหลดดิ้ง
          const loadingIndicator = document.getElementById('loading-indicator');
          if (loadingIndicator) loadingIndicator.style.display = 'none';
        }
      }, 500); // หน่วงเวลาเล็กน้อยเพื่อให้แน่ใจว่าไฟล์ที่เกี่ยวข้องถูกโหลดเรียบร้อยแล้ว
    });
  </script>